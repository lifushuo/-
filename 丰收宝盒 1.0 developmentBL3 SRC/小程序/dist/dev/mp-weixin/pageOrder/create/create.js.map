{"version":3,"file":"create.js","sources":["../../../../../src/pageOrder/create/create.vue","../../../../../uniPage:/cGFnZU9yZGVyXGNyZWF0ZVxjcmVhdGUudnVl"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\nimport type { OrderPreResult } from '@/types/order'\nimport { getMemberOrderPreAPI, getMemberOrderPreNowAPI, postMemberOrderAPI } from '@/services/order'\nimport { onShow } from '@dcloudio/uni-app'\nimport type { AddressItem } from '@/types/address'\nimport { useAddressStore } from '@/stores/modules/address'\n\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n// 订单备注\nconst buyerMessage = ref('')\n// 配送时间\nconst deliveryList = ref([\n    { type: 1, text: '时间不限 (周一至周日)' },\n    { type: 2, text: '工作日送 (周一至周五)' },\n    { type: 3, text: '周末配送 (周六至周日)' },\n])\n// 当前配送时间下标\nconst activeIndex = ref(0)\n// 当前配送时间\nconst activeDelivery = computed(() => deliveryList.value[activeIndex.value])\n// 修改配送时间\nconst onChangeDelivery: UniHelper.SelectorPickerOnChange = (ev) => {\n    activeIndex.value = ev.detail.value\n}\nconst query = defineProps<{\n    skuId?: string\n    count?: string\n}>()\n// 获取订单信息\nconst orderPre = ref<OrderPreResult>()\nconst getMemberOrderPreData = async () => {\n    // 是否有立即购买参数\n    if (query.count && query.skuId) {\n        // 调用立即购买 API\n        const res = await getMemberOrderPreNowAPI({\n            count: query.count,\n            skuId: query.skuId,\n        })\n        orderPre.value = res.result\n    } else {\n        // 调用预付订单 API\n        const res = await getMemberOrderPreAPI()\n        orderPre.value = res.data\n    }\n}\n\nonShow(() => {\n    getMemberOrderPreData()\n})\n//地址仓库\nconst addressStore = useAddressStore()\n\nlet selecteAddress = computed((): AddressItem | undefined => {\n    return (\n        addressStore.selectedAddress || orderPre.value?.userAddresses.find((item) => item.isDefault)\n    )\n})\n\n// 提交订单\nconst onOrderSubmit = async () => {\n    // 没有收货地址提醒\n    if (!selecteAddress.value?.id) {\n        return uni.showToast({ icon: 'none', title: '请选择收货地址' })\n    }\n    // 发送请求\n    const res = await postMemberOrderAPI({\n        addressId: selecteAddress.value?.id,\n        buyerMessage: buyerMessage.value,\n        deliveryTimeType: activeDelivery.value.type,\n        goods: orderPre.value!.goods.map((v) => ({ count: v.count, skuId: v.skuId })),\n        payChannel: 2,\n        payType: 1,\n    })\n    // 关闭当前页面，跳转到订单详情，传递订单id\n    uni.redirectTo({ url: `/pageOrder/detail/detail?id=${res.data.id}` })\n}\n</script>\n\n<template>\n    <scroll-view scroll-y class=\"viewport\">\n        <!-- 收货地址 -->\n        <navigator\n            v-if=\"selecteAddress\"\n            class=\"shipment\"\n            hover-class=\"none\"\n            url=\"/pagesMember/address/address?from=order\"\n        >\n            <view class=\"user\"> {{ selecteAddress!.receiver }} {{ selecteAddress!.contact }} </view>\n            <view class=\"address\">\n                {{ selecteAddress!.fullLocation }} {{ selecteAddress!.address }}\n            </view>\n            <text class=\"icon icon-right\"></text>\n        </navigator>\n        <navigator\n            v-else\n            class=\"shipment\"\n            hover-class=\"none\"\n            url=\"/pagesMember/address/address?from=order\"\n        >\n            <view class=\"address\"> 请选择收货地址 </view>\n            <text class=\"icon icon-right\"></text>\n        </navigator>\n\n        <!-- 商品信息 -->\n        <view class=\"goods\">\n            <navigator\n                v-for=\"item in orderPre?.goods\"\n                :key=\"item.skuId\"\n                :url=\"`/pages/goods/goods?id=${item.id}`\"\n                class=\"item\"\n                hover-class=\"none\"\n            >\n                <image class=\"picture\" :src=\"item.picture\" />\n                <view class=\"meta\">\n                    <view class=\"name ellipsis\"> {{ item.name }} </view>\n                    <view class=\"attrs\"> {{ item.attrsText }}</view>\n                    <view class=\"prices\">\n                        <view class=\"pay-price symbol\">{{ item.payPrice }}</view>\n                        <view class=\"price symbol\">{{ item.price }}</view>\n                    </view>\n                    <view class=\"count\">x{{ item.count }}</view>\n                </view>\n            </navigator>\n        </view>\n\n        <!-- 配送及支付方式 -->\n        <view class=\"related\">\n            <view class=\"item\">\n                <text class=\"text\">配送时间</text>\n                <picker :range=\"deliveryList\" range-key=\"text\" @change=\"onChangeDelivery\">\n                    <view class=\"icon-fonts picker\">{{ activeDelivery.text }}</view>\n                </picker>\n            </view>\n            <view class=\"item\">\n                <text class=\"text\">订单备注</text>\n                <input\n                    class=\"input\"\n                    :cursor-spacing=\"30\"\n                    placeholder=\"选题，建议留言前先与商家沟通确认\"\n                    v-model=\"buyerMessage\"\n                />\n            </view>\n        </view>\n\n        <!-- 支付金额 -->\n        <view class=\"settlement\">\n            <view class=\"item\">\n                <text class=\"text\">商品总价: </text>\n                <text class=\"number symbol\">{{ orderPre?.summary.totalPrice }}</text>\n            </view>\n            <view class=\"item\">\n                <text class=\"text\">运费: </text>\n                <text class=\"number symbol\">{{ orderPre?.summary.postFee }}</text>\n            </view>\n        </view>\n    </scroll-view>\n\n    <!-- 吸底工具栏 -->\n    <view class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n        <view class=\"total-pay symbol\">\n            <text class=\"number\">{{ orderPre?.summary.totalPayPrice }}</text>\n        </view>\n        <view class=\"button\" :class=\"{ disabled: !selecteAddress?.id }\" @tap=\"onOrderSubmit\">\n            提交订单\n        </view>\n    </view>\n</template>\n\n<style lang=\"scss\">\npage {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    overflow: hidden;\n    background-color: #f4f4f4;\n}\n\n.symbol::before {\n    content: '¥';\n    font-size: 80%;\n    margin-right: 5rpx;\n}\n\n.shipment {\n    margin: 20rpx;\n    padding: 30rpx 30rpx 30rpx 84rpx;\n    font-size: 26rpx;\n    border-radius: 10rpx;\n    background: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/locate.png)\n        20rpx center / 50rpx no-repeat #fff;\n    position: relative;\n\n    .icon {\n        font-size: 36rpx;\n        color: #333;\n        transform: translateY(-50%);\n        position: absolute;\n        top: 50%;\n        right: 20rpx;\n    }\n\n    .user {\n        color: #333;\n        margin-bottom: 5rpx;\n    }\n\n    .address {\n        color: #666;\n    }\n}\n\n.goods {\n    margin: 20rpx;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n\n    .item {\n        display: flex;\n        padding: 30rpx 0;\n        border-top: 1rpx solid #eee;\n\n        &:first-child {\n            border-top: none;\n        }\n\n        .picture {\n            width: 170rpx;\n            height: 170rpx;\n            border-radius: 10rpx;\n            margin-right: 20rpx;\n        }\n\n        .meta {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            position: relative;\n        }\n\n        .name {\n            height: 80rpx;\n            font-size: 26rpx;\n            color: #444;\n        }\n\n        .attrs {\n            line-height: 1.8;\n            padding: 0 15rpx;\n            margin-top: 6rpx;\n            font-size: 24rpx;\n            align-self: flex-start;\n            border-radius: 4rpx;\n            color: #888;\n            background-color: #f7f7f8;\n        }\n\n        .prices {\n            display: flex;\n            align-items: baseline;\n            margin-top: 6rpx;\n            font-size: 28rpx;\n\n            .pay-price {\n                margin-right: 10rpx;\n                color: #cf4444;\n            }\n\n            .price {\n                font-size: 24rpx;\n                color: #999;\n                text-decoration: line-through;\n            }\n        }\n\n        .count {\n            position: absolute;\n            bottom: 0;\n            right: 0;\n            font-size: 26rpx;\n            color: #444;\n        }\n    }\n}\n\n.related {\n    margin: 20rpx;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n\n    .item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        min-height: 80rpx;\n        font-size: 26rpx;\n        color: #333;\n    }\n\n    .input {\n        flex: 1;\n        text-align: right;\n        margin: 20rpx 0;\n        padding-right: 20rpx;\n        font-size: 26rpx;\n        color: #999;\n    }\n\n    .item .text {\n        width: 125rpx;\n    }\n\n    .picker {\n        color: #666;\n    }\n\n    .picker::after {\n        content: '\\e6c2';\n    }\n}\n\n/* 结算清单 */\n.settlement {\n    margin: 20rpx;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n\n    .item {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        height: 80rpx;\n        font-size: 26rpx;\n        color: #333;\n    }\n\n    .danger {\n        color: #cf4444;\n    }\n}\n\n/* 吸底工具栏 */\n.toolbar {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: calc(var(--window-bottom));\n    z-index: 1;\n\n    background-color: #fff;\n    height: 100rpx;\n    padding: 0 20rpx;\n    border-top: 1rpx solid #eaeaea;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    box-sizing: content-box;\n\n    .total-pay {\n        font-size: 40rpx;\n        color: #cf4444;\n\n        .decimal {\n            font-size: 75%;\n        }\n    }\n\n    .button {\n        width: 220rpx;\n        text-align: center;\n        line-height: 72rpx;\n        font-size: 26rpx;\n        color: #fff;\n        border-radius: 72rpx;\n        background-color: #27ba9b;\n    }\n\n    .disabled {\n        opacity: 0.6;\n    }\n}\n</style>\n","import MiniProgramPage from 'D:/OneDrive/桌面/uniapp小程序小兔/erabbit-uni-app-vue3-ts-master/src/pageOrder/create/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","computed","getMemberOrderPreNowAPI","getMemberOrderPreAPI","onShow","useAddressStore","postMemberOrderAPI"],"mappings":";;;;;;;;;;;;;;;AASA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAE3C,UAAA,eAAeC,kBAAI,EAAE;AAE3B,UAAM,eAAeA,cAAAA,IAAI;AAAA,MACrB,EAAE,MAAM,GAAG,MAAM,eAAe;AAAA,MAChC,EAAE,MAAM,GAAG,MAAM,eAAe;AAAA,MAChC,EAAE,MAAM,GAAG,MAAM,eAAe;AAAA,IAAA,CACnC;AAEK,UAAA,cAAcA,kBAAI,CAAC;AAEzB,UAAM,iBAAiBC,cAAAA,SAAS,MAAM,aAAa,MAAM,YAAY,KAAK,CAAC;AAErE,UAAA,mBAAqD,CAAC,OAAO;AACnD,kBAAA,QAAQ,GAAG,OAAO;AAAA,IAAA;AAOlC,UAAM,WAAWD,cAAAA;AACjB,UAAM,wBAAwB,YAAY;AAElC,UAAA,MAAM,SAAS,MAAM,OAAO;AAEtB,cAAA,MAAM,MAAME,uCAAwB;AAAA,UACtC,OAAO,MAAM;AAAA,UACb,OAAO,MAAM;AAAA,QAAA,CAChB;AACD,iBAAS,QAAQ,IAAI;AAAA,MAAA,OAClB;AAEG,cAAA,MAAM,MAAMC,eAAAA;AAClB,iBAAS,QAAQ,IAAI;AAAA,MACzB;AAAA,IAAA;AAGJC,kBAAAA,OAAO,MAAM;AACa;IAAA,CACzB;AAED,UAAM,eAAeC,uBAAAA;AAEjB,QAAA,iBAAiBJ,cAAAA,SAAS,MAA+B;;AAErD,aAAA,aAAa,qBAAmB,cAAS,UAAT,mBAAgB,cAAc,KAAK,CAAC,SAAS,KAAK;AAAA,IAAS,CAElG;AAGD,UAAM,gBAAgB,YAAY;;AAE1B,UAAA,GAAC,oBAAe,UAAf,mBAAsB,KAAI;AAC3B,eAAOF,cAAAA,MAAI,UAAU,EAAE,MAAM,QAAQ,OAAO,WAAW;AAAA,MAC3D;AAEM,YAAA,MAAM,MAAMO,kCAAmB;AAAA,QACjC,YAAW,oBAAe,UAAf,mBAAsB;AAAA,QACjC,cAAc,aAAa;AAAA,QAC3B,kBAAkB,eAAe,MAAM;AAAA,QACvC,OAAO,SAAS,MAAO,MAAM,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,OAAO,EAAE,MAAQ,EAAA;AAAA,QAC5E,YAAY;AAAA,QACZ,SAAS;AAAA,MAAA,CACZ;AAEGP,0BAAA,WAAW,EAAE,KAAK,+BAA+B,IAAI,KAAK,EAAE,IAAI;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3ExE,GAAG,WAAW,eAAe;"}