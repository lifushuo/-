{"version":3,"file":"hot.js","sources":["../../../src/pages/hot/hot.vue"],"sourcesContent":["// /src/pages/hot/hot.vue\n<script setup lang=\"ts\">\nimport { getHotPage, getHotRecommendAPI } from '@/services/hot'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { onMounted, ref } from 'vue'\nimport type { HotData, HotDataItem, SubTypeItem } from '@/types/hot'\n\nconst query = defineProps<{\n    type: string\n}>()\n// console.log(query)\n\n// 热门推荐页 标题和url\n// const urlMap = [\n//     { type: '1', title: '特惠推荐', url: '/hot/preference' },\n//     { type: '2', title: '爆款推荐', url: '/hot/inVogue' },\n//     { type: '3', title: '一站买全', url: '/hot/oneStop' },\n//     { type: '4', title: '新鲜好物', url: '/hot/new' },\n// ]\n\n// const currUrlMap = urlMap.find((e) => e.type == query.type)\n// 动态设置标题\nuni.setNavigationBarTitle({ title: '商品' })\n\n// 推荐页面图\nconst bannerPicture = ref('')\nconst subType = ref<(SubTypeItem & { finish?: boolean })[]>([])\n// 高亮下标\nconst activeIndex = ref(0)\n\n// 获取热门推荐数据\n// const getHotRecommandData = async () => {\n//     let res = await getHotRecommendAPI(currUrlMap!.url, {\n//         //技巧： 环境变量，开发环境 修改初始化页面方便测试分页结束\n//         page: import.meta.env.DEV ? 30 : 1,\n//         pageSize: 10,\n//     })\n//     bannerPicture.value = res.result.bannerPicture\n//     subType.value = res.result.subTypes\n// }\nconst getHotRecommandData = async () => {\n    // let res = await getHotRecommendAPI('/user/goods/page', {\n    //     //技巧： 环境变量，开发环境 修改初始化页面方便测试分页结束\n    //     page: 1,\n    //     pageSize: 10,\n    // })\n    let res = await getHotPage({\n        //技巧： 环境变量，开发环境 修改初始化页面方便测试分页结束\n        page: 1,\n        pageSize: 10,\n    })\n    console.log(res)\n    hotPageData.value = res.data\n    hotData.value = res.data.items\n}\n\nconst getNewData = async () => {\n    if (\n        hotPageData.value!.page * (hotPageData.value!.pageSize as number) <\n        hotPageData.value!.counts\n    ) {\n    } else {\n        isfinish.value = true\n        uni.showToast({\n            title: '没有更多数据了',\n            icon: 'none',\n        })\n        return\n    }\n    hotPageData.value!.page += 1\n\n    console.log(hotPageData.value!.page)\n    let res = await getHotPage({\n        //技巧： 环境变量，开发环境 修改初始化页面方便测试分页结束\n        page: hotPageData.value!.page,\n        pageSize: hotPageData.value!.pageSize as number,\n    })\n    console.log(res)\n    hotPageData.value = res.data\n    hotData.value = res.data.items\n    //   获取当前的选项\n    // const currsubType = subType.value[activeIndex.value]\n    //分页条件\n    // if (currsubType.goodsItems.page <= currsubType.goodsItems.pages) {\n    //     currsubType.goodsItems.page++\n    // } else {\n    //     // 标记已结束\n    //     currsubType.finish = true\n    //     uni.showToast({\n    //         title: '没有更多数据了',\n    //         icon: 'none',\n    //     })\n    //     return\n    // }\n    // // 调用API传参\n    // const res = await getHotRecommendAPI('/user/goods/page', {\n    //     subType: currsubType.id,\n    //     page: currsubType.goodsItems.page,\n    //     pageSize: currsubType.goodsItems.pageSize,\n    // })\n    // currsubType.goodsItems.items = res.result.subTypes[activeIndex.value].goodsItems.items\n}\ndefineExpose({\n    getNewData,\n})\n\n//滚动触底\nconst onScrolltolower = async () => {\n    // //   获取当前的选项\n    // const currsubType = subType.value[activeIndex.value]\n    // //分页条件\n    // if (currsubType.goodsItems.page <= currsubType.goodsItems.pages) {\n    //     currsubType.goodsItems.page++\n    // } else {\n    //     // 标记已结束\n    //     currsubType.finish = true\n    //     uni.showToast({\n    //         title: '没有更多数据了',\n    //         icon: 'none',\n    //     })\n    //     return\n    // }\n\n    console.log(hotPageData.value!.page)\n    console.log(hotPageData.value!.pageSize)\n    console.log(hotPageData.value!.counts)\n\n    if (\n        hotPageData.value!.page * (hotPageData.value!.pageSize as number) >=\n        hotPageData.value!.counts\n    ) {\n        isfinish.value = true\n        uni.showToast({\n            title: '没有更多数据了',\n            icon: 'none',\n        })\n        return\n    }\n\n    hotPageData.value!.page += 1\n    console.log(hotPageData.value!.page)\n    let res = await getHotPage({\n        //技巧： 环境变量，开发环境 修改初始化页面方便测试分页结束\n        page: hotPageData.value!.page,\n        pageSize: hotPageData.value!.pageSize as number,\n    })\n    console.log(res)\n    hotPageData.value = res.data\n    hotData.value?.push(...res.data.items)\n    // 调用API传参\n    // const res = await getHotRecommendAPI('/hot/preference', {\n    //     subType: currsubType.id,\n    //     page: currsubType.goodsItems.page,\n    //     pageSize: currsubType.goodsItems.pageSize,\n    // })\n    // currsubType.goodsItems.items.push(...res.result.subTypes[activeIndex.value].goodsItems.items)\n}\nlet hotPageData = ref<HotData>()\nlet hotData = ref<HotDataItem[]>()\nlet isfinish = ref(false)\n// 页面加载\nonMounted(() => {\n    getHotRecommandData()\n})\n</script>\n\n<template>\n    <view class=\"viewport\">\n        <!--        &lt;!&ndash; 推荐封面图 &ndash;&gt;-->\n        <!--        <view class=\"cover\">-->\n        <!--            <image :src=\"bannerPicture\"></image>-->\n        <!--        </view>-->\n        <!--        &lt;!&ndash; 推荐选项 &ndash;&gt;-->\n        <!--        <view class=\"tabs\">-->\n        <!--            <text-->\n        <!--                class=\"text\"-->\n        <!--                :class=\"{ active: index == activeIndex }\"-->\n        <!--                v-for=\"(item, index) in subType\"-->\n        <!--                :key=\"index\"-->\n        <!--                @tap=\"activeIndex = index\"-->\n        <!--            >-->\n        <!--                {{ item.title }}-->\n        <!--            </text>-->\n        <!--        </view>-->\n        <!-- 推荐列表 -->\n        <scroll-view :scroll-y=\"true\" class=\"scroll-view\" @scrolltolower=\"onScrolltolower\">\n            <view class=\"goods\">\n                <navigator\n                    hover-class=\"none\"\n                    class=\"navigator\"\n                    v-for=\"goods in hotData\"\n                    :key=\"goods.id\"\n                    :url=\"`/pages/goods/goods?id=${goods.id}`\"\n                >\n                    <image class=\"thumb\" :src=\"goods.picture\"></image>\n                    <view class=\"name ellipsis\">{{ goods.name }}</view>\n                    <view class=\"price\">\n                        <text class=\"symbol\">¥</text>\n                        <text class=\"number\">{{ goods.price }}</text>\n                    </view>\n                </navigator>\n            </view>\n            <view class=\"loading-text\"\n                >{{ isfinish == true ? '正在加载...' : '没有更多数据了' }}\n            </view>\n        </scroll-view>\n    </view>\n</template>\n\n<style lang=\"scss\">\npage {\n    height: 100%;\n    background-color: #f4f4f4;\n}\n\n.viewport {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    //padding: 180rpx 0 0;\n    position: relative;\n}\n\n//\n//.cover {\n//    width: 750rpx;\n//    height: 225rpx;\n//    border-radius: 0 0 40rpx 40rpx;\n//    overflow: hidden;\n//    position: absolute;\n//    left: 0;\n//    top: 0;\n//}\n\n.scroll-view {\n    flex: 1;\n}\n\n//.tabs {\n//    display: flex;\n//    justify-content: space-evenly;\n//    //height: 100rpx;\n//    line-height: 90rpx;\n//    margin: 0 20rpx;\n//    font-size: 28rpx;\n//    border-radius: 10rpx;\n//    box-shadow: 0 4rpx 5rpx rgba(200, 200, 200, 0.3);\n//    color: #333;\n//    background-color: #fff;\n//    position: relative;\n//    z-index: 9;\n//\n//    .text {\n//        margin: 0 20rpx;\n//        position: relative;\n//    }\n//\n//    .active {\n//        &::after {\n//            content: '';\n//            width: 40rpx;\n//            height: 4rpx;\n//            transform: translate(-50%);\n//            background-color: #27ba9b;\n//            position: absolute;\n//            left: 50%;\n//            bottom: 24rpx;\n//        }\n//    }\n//}\n\n.goods {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    padding: 0 20rpx 20rpx;\n\n    .navigator {\n        width: 345rpx;\n        padding: 20rpx;\n        margin-top: 20rpx;\n        border-radius: 10rpx;\n        background-color: #fff;\n    }\n\n    .thumb {\n        width: 305rpx;\n        height: 305rpx;\n    }\n\n    .name {\n        height: 88rpx;\n        font-size: 26rpx;\n    }\n\n    .price {\n        line-height: 1;\n        color: #cf4444;\n        font-size: 30rpx;\n    }\n\n    .symbol {\n        font-size: 70%;\n    }\n\n    .decimal {\n        font-size: 70%;\n    }\n}\n\n.loading-text {\n    text-align: center;\n    font-size: 28rpx;\n    color: #666;\n    //padding: 20rpx 0 50rpx;\n}\n</style>\n"],"names":["uni","ref","getHotPage","onMounted"],"mappings":";;;;;;;;;AAsBAA,kBAAAA,MAAI,sBAAsB,EAAE,OAAO,KAAM,CAAA;AAGnBC,kBAAAA,IAAI,EAAE;AACZA,kBAAAA,IAA4C,CAAA,CAAE;AAE1CA,kBAAAA,IAAI,CAAC;AAYzB,UAAM,sBAAsB,YAAY;AAMhC,UAAA,MAAM,MAAMC,wBAAW;AAAA;AAAA,QAEvB,MAAM;AAAA,QACN,UAAU;AAAA,MAAA,CACb;AACD,cAAQ,IAAI,GAAG;AACf,kBAAY,QAAQ,IAAI;AAChB,cAAA,QAAQ,IAAI,KAAK;AAAA,IAAA;AAG7B,UAAM,aAAa,YAAY;AAEvB,UAAA,YAAY,MAAO,OAAQ,YAAY,MAAO,WAC9C,YAAY,MAAO;AACrB;AAAA,WACK;AACH,iBAAS,QAAQ;AACjBF,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACT;AACD;AAAA,MACJ;AACA,kBAAY,MAAO,QAAQ;AAEnB,cAAA,IAAI,YAAY,MAAO,IAAI;AAC/B,UAAA,MAAM,MAAME,wBAAW;AAAA;AAAA,QAEvB,MAAM,YAAY,MAAO;AAAA,QACzB,UAAU,YAAY,MAAO;AAAA,MAAA,CAChC;AACD,cAAQ,IAAI,GAAG;AACf,kBAAY,QAAQ,IAAI;AAChB,cAAA,QAAQ,IAAI,KAAK;AAAA,IAAA;AAuBhB,WAAA;AAAA,MACT;AAAA,IAAA,CACH;AAGD,UAAM,kBAAkB,YAAY;;AAgBxB,cAAA,IAAI,YAAY,MAAO,IAAI;AAC3B,cAAA,IAAI,YAAY,MAAO,QAAQ;AAC/B,cAAA,IAAI,YAAY,MAAO,MAAM;AAGjC,UAAA,YAAY,MAAO,OAAQ,YAAY,MAAO,YAC9C,YAAY,MAAO,QACrB;AACE,iBAAS,QAAQ;AACjBF,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACT;AACD;AAAA,MACJ;AAEA,kBAAY,MAAO,QAAQ;AACnB,cAAA,IAAI,YAAY,MAAO,IAAI;AAC/B,UAAA,MAAM,MAAME,wBAAW;AAAA;AAAA,QAEvB,MAAM,YAAY,MAAO;AAAA,QACzB,UAAU,YAAY,MAAO;AAAA,MAAA,CAChC;AACD,cAAQ,IAAI,GAAG;AACf,kBAAY,QAAQ,IAAI;AACxB,oBAAQ,UAAR,mBAAe,KAAK,GAAG,IAAI,KAAK;AAAA,IAAK;AASzC,QAAI,cAAcD,cAAAA;AAClB,QAAI,UAAUA,cAAAA;AACV,QAAA,WAAWA,kBAAI,KAAK;AAExBE,kBAAAA,UAAU,MAAM;AACQ;IAAA,CACvB;;;;;;;;;;;;;;;;;;;;"}