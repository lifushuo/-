{"version":3,"file":"goods.js","sources":["../../../../../src/pages/goods/goods.vue","../../../../../uniPage:/cGFnZXMvZ29vZHMvZ29vZHMudnVl"],"sourcesContent":["// src/pages/goods/goods.vue\n<script setup lang=\"ts\">\n// 获取屏幕边界到安全区域距离\nimport { getGoodsByIdAPI } from '@/services/goods'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { computed, ref } from 'vue'\nimport type { GoodsResult } from '@/types/goods'\nimport AddressPanel from '@/pages/goods/components/AddressPanel.vue'\nimport ServicePanel from '@/pages/goods/components/ServicePanel.vue'\nimport PageSkeleton from '@/pages/goods/components/PageSkeleton.vue'\nimport type {\n    SkuPopupEvent,\n    SkuPopupInstance,\n    SkuPopupLocaldata,\n    SkuPopupSkuItem,\n} from '@/components/vk-data-goods-sku-popup/vk-data-goods-sku-popup'\nimport { postMemberCartAPI, putMemberCartBySkuIdAPI } from '@/services/cart'\nimport type { InputNumberBoxEvent } from '@/components/vk-data-input-number-box/vk-data-input-number-box'\n\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\nconst query = defineProps<{\n    id: string\n}>()\n\nconst goods = ref<GoodsResult>()\n\n// 获取商品的详细信息\nconst getGoodsByIdData = async () => {\n    const res = await getGoodsByIdAPI(query.id)\n    // console.log(res)\n    goods.value = res.data\n    localdata.value = {\n        _id: res.data.id,\n        name: res.data.name,\n        goods_thumb: res.data.mainPictures[0],\n        spec_list: res.data.specs.map((v) => {\n            return {\n                name: v.name,\n                list: v.specValues,\n            }\n        }),\n        sku_list: res.data.skus.map((v): SkuPopupSkuItem => {\n            return {\n                _id: v.id,\n                goods_id: res.data.id,\n                goods_name: res.data.name,\n                image: v.picture,\n                price: v.price * 100,\n                stock: v.inventory,\n                sku_name_arr: v.specs.map((vv) => vv.value),\n            }\n        }),\n    }\n}\nconst pictureIndex = ref(0)\n// 是否加载完毕\nconst isFinished = ref(false)\nonLoad(async () => {\n    isFinished.value = false\n    await getGoodsByIdData()\n    isFinished.value = true\n})\n\nconst onChange: UniHelper.SwiperOnChange = (ev) => {\n    // console.log(ev)\n    // console.log(event)\n    pictureIndex.value = ev?.detail.current\n}\n\nconst onTapImage = (url: string) => {\n    uni.previewImage({\n        current: url,\n        urls: goods.value!.mainPictures,\n    })\n}\n\n// uni - ui 弹出层组件\nconst popup = ref<{\n    open: (type?: UniHelper.UniPopupType) => void\n    close: () => void\n}>()\n\nconst popupName = ref<'service' | 'address'>()\nconst openPopup = (name: typeof popupName.value) => {\n    popupName.value = name\n    popup.value?.open()\n}\n\n// 关闭弹出框\nconst closePopup = () => {\n    popup.value?.close()\n}\n\nconst isShowSku = ref(false)\nconst localdata = ref<SkuPopupLocaldata>({} as SkuPopupLocaldata)\n// const popup = ref<UniHelper.UniPopup>()\n\nenum skuMode {\n    Both = 1,\n    Cart = 2,\n    Buy = 3,\n}\n\nconst skuPopupRef = ref<SkuPopupInstance>()\nconst selectAttrText = computed(() => {\n    return skuPopupRef.value?.selectArr?.join(' ').trim() || '请选择商品规格'\n})\n\nconst mode = ref<skuMode>(skuMode.Both)\n\nconst onAddCart = async (ev: SkuPopupEvent) => {\n    await postMemberCartAPI({ skuId: ev._id, count: ev.buy_num })\n    uni.showToast({ title: '添加成功' })\n    isShowSku.value = false\n}\n\nconst onBuyNow = (ev: SkuPopupEvent) => {\n    uni.navigateTo({ url: `/pageOrder/create/create?skuId=${ev._id}&count=${ev.buy_num}` })\n}\n</script>\n\n<template>\n    <vk-data-goods-sku-popup\n        ref=\"skuPopupRef\"\n        v-model=\"isShowSku\"\n        :localdata=\"localdata\"\n        :mode=\"mode\"\n        @add-cart=\"onAddCart\"\n        @buy-now=\"onBuyNow\"\n    />\n    <PageSkeleton v-if=\"isFinished == false\" />\n    <scroll-view v-else :scroll-y=\"true\" class=\"viewport\">\n        <!-- 基本信息 -->\n        <view class=\"goods\">\n            <!-- 商品主图 -->\n            <view class=\"preview\">\n                <swiper @change=\"onChange\" :circular=\"true\">\n                    <swiper-item v-for=\"(item, index) in goods?.mainPictures\" :key=\"index\">\n                        <image @tap=\"onTapImage(item)\" mode=\"aspectFill\" :src=\"item\" />\n                    </swiper-item>\n                </swiper>\n                <view class=\"indicator\">\n                    <text class=\"current\">{{ pictureIndex + 1 }}</text>\n                    <text class=\"split\">/</text>\n                    <text class=\"total\">{{ goods?.mainPictures?.length }}</text>\n                </view>\n            </view>\n\n            <!-- 商品简介 -->\n            <view class=\"meta\">\n                <view class=\"price\">\n                    <text class=\"symbol\">¥</text>\n                    <text class=\"number\">{{ goods?.price }}</text>\n                </view>\n                <view class=\"name ellipsis\">{{ goods?.name }}</view>\n                <view class=\"desc\"> {{ goods?.desc }}</view>\n            </view>\n\n            <!-- 操作面板 -->\n            <view class=\"action\">\n                <view class=\"item arrow\" @tap=\"isShowSku = true\">\n                    <text class=\"label\">选择</text>\n                    <text class=\"text ellipsis\"> {{ selectAttrText }}</text>\n                </view>\n                <view class=\"item arrow\" @tap=\"openPopup('address')\">\n                    <text class=\"label\">送至</text>\n                    <text class=\"text ellipsis\"> 请选择收获地址</text>\n                </view>\n                <view class=\"item arrow\" @tap=\"openPopup('service')\">\n                    <text class=\"label\">服务</text>\n                    <text class=\"text ellipsis\"> 无忧退 快速退款 免费包邮</text>\n                </view>\n            </view>\n        </view>\n\n        <!-- 商品详情 -->\n        <view class=\"detail panel\">\n            <view class=\"title\">\n                <text>详情</text>\n            </view>\n            <view class=\"content\">\n                <view class=\"properties\">\n                    <!-- 属性详情 -->\n                    <view\n                        class=\"item\"\n                        v-for=\"(item, index) in goods?.details.properties\"\n                        :key=\"index\"\n                    >\n                        <text class=\"label\">{{ item.name }}</text>\n                        <text class=\"value\">{{ item.value }}</text>\n                    </view>\n                </view>\n                <!-- 图片详情 -->\n                <image\n                    v-for=\"item in goods?.details.picture\"\n                    mode=\"widthFix\"\n                    :key=\"item\"\n                    :src=\"item\"\n                ></image>\n            </view>\n        </view>\n\n        <!-- 同类推荐 -->\n        <view class=\"similar panel\">\n            <view class=\"title\">\n                <text>同类推荐</text>\n            </view>\n            <view class=\"content\">\n                <navigator\n                    v-for=\"(item, index) in goods?.similarProducts\"\n                    :key=\"index\"\n                    class=\"goods\"\n                    hover-class=\"none\"\n                    :url=\"`/pages/goods/goods?id=`\"\n                >\n                    <image class=\"image\" mode=\"aspectFill\" :src=\"item.picture\"></image>\n                    <view class=\"name ellipsis\">{{ item.name }}</view>\n                    <view class=\"price\">\n                        <text class=\"symbol\">¥</text>\n                        <text class=\"number\">{{ item.price }}</text>\n                    </view>\n                </navigator>\n            </view>\n        </view>\n    </scroll-view>\n    <!-- 用户操作 -->\n    <view class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n        <view class=\"icons\">\n            <button class=\"icons-button\">\n                <text class=\"icon-heart\"></text>\n                收藏\n            </button>\n            <button class=\"icons-button\" open-type=\"contact\">\n                <text class=\"icon-handset\"></text>\n                客服\n            </button>\n            <navigator class=\"icons-button\" url=\"/pages/cart/cart2/cart2\">\n                <text class=\"icon-cart\"></text>\n                购物车\n            </navigator>\n        </view>\n        <view class=\"buttons\">\n            <view class=\"addcart\" @tap=\";(isShowSku = true), (mode = skuMode.Cart)\">\n                加入购物车</view\n            >\n            <view class=\"buynow\" @tap=\";(isShowSku = true), (mode = skuMode.Buy)\"> 立即购买</view>\n        </view>\n    </view>\n    <uni-popup ref=\"popup\" type=\"bottom\">\n        <AddressPanel @close=\"closePopup\" v-if=\"popupName == 'address'\" />\n        <ServicePanel @close=\"closePopup\" v-if=\"popupName == 'service'\" />\n    </uni-popup>\n</template>\n\n<style lang=\"scss\">\npage {\n    height: 100%;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n.viewport {\n    background-color: #f4f4f4;\n}\n\n.panel {\n    margin-top: 20rpx;\n    background-color: #fff;\n\n    .title {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        height: 90rpx;\n        line-height: 1;\n        padding: 30rpx 60rpx 30rpx 6rpx;\n        position: relative;\n\n        text {\n            padding-left: 10rpx;\n            font-size: 28rpx;\n            color: #333;\n            font-weight: 600;\n            border-left: 4rpx solid #27ba9b;\n        }\n\n        navigator {\n            font-size: 24rpx;\n            color: #666;\n        }\n    }\n}\n\n.arrow {\n    &::after {\n        position: absolute;\n        top: 50%;\n        right: 30rpx;\n        content: '\\e6c2';\n        color: #ccc;\n        font-family: 'erabbit' !important;\n        font-size: 32rpx;\n        transform: translateY(-50%);\n    }\n}\n\n/* 商品信息 */\n.goods {\n    background-color: #fff;\n\n    .preview {\n        height: 750rpx;\n        position: relative;\n\n        .image {\n            width: 750rpx;\n            height: 750rpx;\n        }\n\n        .indicator {\n            height: 40rpx;\n            padding: 0 24rpx;\n            line-height: 40rpx;\n            border-radius: 30rpx;\n            color: #fff;\n            font-family: Arial, Helvetica, sans-serif;\n            background-color: rgba(0, 0, 0, 0.3);\n            position: absolute;\n            bottom: 30rpx;\n            right: 30rpx;\n\n            .current {\n                font-size: 26rpx;\n            }\n\n            .split {\n                font-size: 24rpx;\n                margin: 0 1rpx 0 2rpx;\n            }\n\n            .total {\n                font-size: 24rpx;\n            }\n        }\n    }\n\n    .meta {\n        position: relative;\n        border-bottom: 1rpx solid #eaeaea;\n\n        .price {\n            height: 130rpx;\n            padding: 25rpx 30rpx 0;\n            color: #fff;\n            font-size: 34rpx;\n            box-sizing: border-box;\n            background-color: #3f536e;\n        }\n\n        .number {\n            font-size: 56rpx;\n        }\n\n        .brand {\n            width: 160rpx;\n            height: 80rpx;\n            overflow: hidden;\n            position: absolute;\n            top: 26rpx;\n            right: 30rpx;\n        }\n\n        .name {\n            max-height: 88rpx;\n            line-height: 1.4;\n            margin: 20rpx;\n            font-size: 32rpx;\n            color: #333;\n        }\n\n        .desc {\n            line-height: 1;\n            padding: 0 20rpx 30rpx;\n            font-size: 24rpx;\n            color: #cf4444;\n        }\n    }\n\n    .action {\n        padding-left: 20rpx;\n\n        .item {\n            height: 90rpx;\n            padding-right: 60rpx;\n            border-bottom: 1rpx solid #eaeaea;\n            font-size: 26rpx;\n            color: #333;\n            position: relative;\n            display: flex;\n            align-items: center;\n\n            &:last-child {\n                border-bottom: 0 none;\n            }\n        }\n\n        .label {\n            width: 60rpx;\n            color: #898b94;\n            margin: 0 16rpx 0 10rpx;\n        }\n\n        .text {\n            flex: 1;\n            -webkit-line-clamp: 1;\n        }\n    }\n}\n\n/* 商品详情 */\n.detail {\n    padding-left: 20rpx;\n\n    .content {\n        margin-left: -20rpx;\n\n        .image {\n            width: 100%;\n        }\n    }\n\n    .properties {\n        padding: 0 20rpx;\n        margin-bottom: 30rpx;\n\n        .item {\n            display: flex;\n            line-height: 2;\n            padding: 10rpx;\n            font-size: 26rpx;\n            color: #333;\n            border-bottom: 1rpx dashed #ccc;\n        }\n\n        .label {\n            width: 200rpx;\n        }\n\n        .value {\n            flex: 1;\n        }\n    }\n}\n\n/* 同类推荐 */\n.similar {\n    .content {\n        padding: 0 20rpx 200rpx;\n        background-color: #f4f4f4;\n        display: flex;\n        flex-wrap: wrap;\n\n        .goods {\n            width: 340rpx;\n            padding: 24rpx 20rpx 20rpx;\n            margin: 20rpx 7rpx;\n            border-radius: 10rpx;\n            background-color: #fff;\n        }\n\n        .image {\n            width: 300rpx;\n            height: 260rpx;\n        }\n\n        .name {\n            height: 80rpx;\n            margin: 10rpx 0;\n            font-size: 26rpx;\n            color: #262626;\n        }\n\n        .price {\n            line-height: 1;\n            font-size: 20rpx;\n            color: #cf4444;\n        }\n\n        .number {\n            font-size: 26rpx;\n            margin-left: 2rpx;\n        }\n    }\n\n    navigator {\n        &:nth-child(even) {\n            margin-right: 0;\n        }\n    }\n}\n\n/* 底部工具栏 */\n.toolbar {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 1;\n    background-color: #fff;\n    height: 100rpx;\n    padding: 0 20rpx var(--window-bottom);\n    border-top: 1rpx solid #eaeaea;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    box-sizing: content-box;\n\n    .buttons {\n        display: flex;\n\n        & > view {\n            width: 220rpx;\n            text-align: center;\n            line-height: 72rpx;\n            font-size: 26rpx;\n            color: #fff;\n            border-radius: 72rpx;\n        }\n\n        .addcart {\n            background-color: #ffa868;\n        }\n\n        .buynow,\n        .payment {\n            background-color: #3f536e;\n            margin-left: 20rpx;\n        }\n    }\n\n    .icons {\n        padding-right: 10rpx;\n        display: flex;\n        align-items: center;\n        flex: 1;\n\n        .icons-button {\n            flex: 1;\n            text-align: center;\n            line-height: 1.4;\n            padding: 0;\n            margin: 0;\n            border-radius: 0;\n            font-size: 20rpx;\n            color: #333;\n            background-color: #fff;\n\n            &::after {\n                border: none;\n            }\n        }\n\n        text {\n            display: block;\n            font-size: 34rpx;\n        }\n    }\n}\n</style>\n","import MiniProgramPage from 'D:/OneDrive/桌面/uniapp小程序小兔/erabbit-uni-app-vue3-ts-master/src/pages/goods/goods.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getGoodsByIdAPI","onLoad","computed","postMemberCartAPI"],"mappings":";;;;;;;;;;;;;;;;;AAOA,MAAA,eAAyB,MAAA;AACzB,MAAA,eAAyB,MAAA;AACzB,MAAA,eAAyB,MAAA;;;;;;;;AAUzB,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAMjD,UAAM,QAAQC,cAAAA;AAGd,UAAM,mBAAmB,YAAY;AACjC,YAAM,MAAM,MAAMC,eAAAA,gBAAgB,MAAM,EAAE;AAE1C,YAAM,QAAQ,IAAI;AAClB,gBAAU,QAAQ;AAAA,QACd,KAAK,IAAI,KAAK;AAAA,QACd,MAAM,IAAI,KAAK;AAAA,QACf,aAAa,IAAI,KAAK,aAAa,CAAC;AAAA,QACpC,WAAW,IAAI,KAAK,MAAM,IAAI,CAAC,MAAM;AAC1B,iBAAA;AAAA,YACH,MAAM,EAAE;AAAA,YACR,MAAM,EAAE;AAAA,UAAA;AAAA,QACZ,CACH;AAAA,QACD,UAAU,IAAI,KAAK,KAAK,IAAI,CAAC,MAAuB;AACzC,iBAAA;AAAA,YACH,KAAK,EAAE;AAAA,YACP,UAAU,IAAI,KAAK;AAAA,YACnB,YAAY,IAAI,KAAK;AAAA,YACrB,OAAO,EAAE;AAAA,YACT,OAAO,EAAE,QAAQ;AAAA,YACjB,OAAO,EAAE;AAAA,YACT,cAAc,EAAE,MAAM,IAAI,CAAC,OAAO,GAAG,KAAK;AAAA,UAAA;AAAA,QAC9C,CACH;AAAA,MAAA;AAAA,IACL;AAEE,UAAA,eAAeD,kBAAI,CAAC;AAEpB,UAAA,aAAaA,kBAAI,KAAK;AAC5BE,kBAAAA,OAAO,YAAY;AACf,iBAAW,QAAQ;AACnB,YAAM,iBAAiB;AACvB,iBAAW,QAAQ;AAAA,IAAA,CACtB;AAEK,UAAA,WAAqC,CAAC,OAAO;AAGlC,mBAAA,QAAQ,yBAAI,OAAO;AAAA,IAAA;AAG9B,UAAA,aAAa,CAAC,QAAgB;AAChCH,oBAAAA,MAAI,aAAa;AAAA,QACb,SAAS;AAAA,QACT,MAAM,MAAM,MAAO;AAAA,MAAA,CACtB;AAAA,IAAA;AAIL,UAAM,QAAQC,cAAAA;AAKd,UAAM,YAAYA,cAAAA;AACZ,UAAA,YAAY,CAAC,SAAiC;;AAChD,gBAAU,QAAQ;AAClB,kBAAM,UAAN,mBAAa;AAAA,IAAK;AAItB,UAAM,aAAa,MAAM;;AACrB,kBAAM,UAAN,mBAAa;AAAA,IAAM;AAGjB,UAAA,YAAYA,kBAAI,KAAK;AACrB,UAAA,YAAYA,kBAAuB,CAAA,CAAuB;AAShE,UAAM,cAAcA,cAAAA;AACd,UAAA,iBAAiBG,cAAAA,SAAS,MAAM;;AAClC,eAAO,uBAAY,UAAZ,mBAAmB,cAAnB,mBAA8B,KAAK,KAAK,WAAU;AAAA,IAAA,CAC5D;AAEK,UAAA,OAAOH;MAAa;AAAA;AAAA;AAEpB,UAAA,YAAY,OAAO,OAAsB;AACrC,YAAAI,cAAA,kBAAkB,EAAE,OAAO,GAAG,KAAK,OAAO,GAAG,SAAS;AAC5DL,oBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B,gBAAU,QAAQ;AAAA,IAAA;AAGhB,UAAA,WAAW,CAAC,OAAsB;AAChCA,oBAAAA,MAAA,WAAW,EAAE,KAAK,kCAAkC,GAAG,GAAG,UAAU,GAAG,OAAO,GAAI,CAAA;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrH1F,GAAG,WAAW,eAAe;"}