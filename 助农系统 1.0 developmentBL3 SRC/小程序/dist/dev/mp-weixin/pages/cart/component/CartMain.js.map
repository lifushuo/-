{"version":3,"file":"CartMain.js","sources":["../../../../../../src/pages/cart/component/CartMain.vue","../../../../../../uniComponent:/RDovT25lRHJpdmUv5qGM6Z2iL3VuaWFwcOWwj-eoi-W6j-Wwj-WFlC9lcmFiYml0LXVuaS1hcHAtdnVlMy10cy1tYXN0ZXIvc3JjL3BhZ2VzL2NhcnQvY29tcG9uZW50L0NhcnRNYWluLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\n//\nimport { useMemberStore } from '@/stores'\nimport { onShow } from '@dcloudio/uni-app'\nimport { computed, ref, watch } from 'vue'\nimport type { CartItem } from '@/types/cart'\nimport {\n    deleteMemberCartAPI,\n    getMemberCartAPI,\n    putMemberCartBySkuIdAPI,\n    putMemberCartSelectedAPI,\n} from '@/services/cart'\nimport type { InputNumberBoxEvent } from '@/components/vk-data-input-number-box/vk-data-input-number-box'\n\nconst memberStore = useMemberStore()\n// 获取购物车数据\nconst cartList = ref<CartItem[]>([])\nconst getMemberCartData = async () => {\n    const res = await getMemberCartAPI()\n    cartList.value = res.data\n\n    console.log(res.data)\n    console.log(cartList.value)\n}\n\n// 修改选中状态-单品修改\nconst onChangeSelected = (item: CartItem) => {\n    // 前端数据更新-是否选中取反\n    item.is_selected = !item.is_selected\n    // 后端数据更新\n    putMemberCartBySkuIdAPI(item.skuId, { selected: item.is_selected == true ? 1 : 0 })\n}\n\nonShow(() => {\n    if (memberStore.profile) {\n        getMemberCartData()\n    }\n})\n// 结算按钮\nconst gotoPayment = () => {\n    if (selectedCartListCount.value === 0) {\n        return uni.showToast({\n            icon: 'none',\n            title: '请选择商品',\n        })\n    }\n    // 跳转到结算页\n    uni.navigateTo({ url: '/pageOrder/create/create' })\n}\n// 点击删除按钮\nconst onDeleteCart = (skuId: string) => {\n    // 弹窗二次确认\n    uni.showModal({\n        content: '是否删除',\n        success: async (res) => {\n            if (res.confirm) {\n                // 后端删除单品\n                await deleteMemberCartAPI({ ids: [skuId] })\n                // 重新获取列表\n                getMemberCartData()\n            }\n        },\n    })\n}\n\n// 计算全选状态\nconst isSelectedAll = computed(() => {\n    return cartList.value.length && cartList.value.every((v) => v.is_selected)\n})\n\n// 修改选中状态-全选修改\nconst onChangeSelectedAll = () => {\n    // 全选状态取反\n    const _isSelectedAll = !isSelectedAll.value\n    // 前端数据更新\n    cartList.value.forEach((item) => {\n        item.is_selected = _isSelectedAll\n    })\n    // 后端数据更新\n    putMemberCartSelectedAPI({ selected: _isSelectedAll })\n}\n\nconst onChangeCount = (ev: InputNumberBoxEvent) => {\n    console.log(ev)\n    putMemberCartBySkuIdAPI(ev.index, { count: ev.value })\n}\n\nconst fleshSelectedCartList = () => {\n    selectedCartList.value = cartList.value.filter((v) => v.is_selected)\n}\n// 计算选中单品列表\nlet selectedCartList = computed(() => {\n    return cartList.value.filter((v) => v.is_selected)\n})\n\n// 计算选中总件数\nconst selectedCartListCount = computed(() => {\n    return selectedCartList.value.reduce((sum, item) => sum + item.count, 0)\n})\n\n// 计算选中总金额\nconst selectedCartListMoney = computed(() => {\n    return selectedCartList.value.reduce((sum, item) => sum + item.count * item.price, 0).toFixed(2)\n})\n</script>\n\n<template>\n    <scroll-view scroll-y class=\"scroll-view\">\n        <!-- 已登录: 显示购物车 -->\n        <template v-if=\"memberStore.profile?.id\">\n            <!-- 购物车列表 -->\n            <view class=\"cart-list\" v-if=\"true\">\n                <!-- 优惠提示 -->\n                <!-- 滑动操作分区 -->\n                <uni-swipe-action>\n                    <!-- 滑动操作项 -->\n                    <uni-swipe-action-item\n                        v-for=\"item in cartList\"\n                        :key=\"item.skuId\"\n                        class=\"cart-swipe\"\n                    >\n                        <!-- 商品信息 -->\n                        <view class=\"goods\">\n                            <!-- 选中状态 -->\n                            <text\n                                @tap=\"onChangeSelected(item)\"\n                                class=\"checkbox\"\n                                :class=\"{ checked: item.is_selected }\"\n                            ></text>\n                            <navigator\n                                :url=\"`/pages/goods/goods?id=${item.spuId}`\"\n                                hover-class=\"none\"\n                                class=\"navigator\"\n                            >\n                                <image\n                                    mode=\"aspectFill\"\n                                    class=\"picture\"\n                                    :src=\"item.picture\"\n                                ></image>\n                                <view class=\"meta\">\n                                    <view class=\"name ellipsis\">{{ item.skuName }}</view>\n                                    <view class=\"attrsText ellipsis\">{{ item.attrsText }}</view>\n                                    <view class=\"price\">{{ item.price }}</view>\n                                </view>\n                            </navigator>\n                            <!-- 商品数量 -->\n                            <view class=\"count\">\n                                <vk-data-input-number-box\n                                    @change=\"onChangeCount\"\n                                    :min=\"1\"\n                                    :max=\"item.stock\"\n                                    :index=\"item.skuId\"\n                                    v-model:model-value=\"item.count\"\n                                />\n                            </view>\n                        </view>\n                        <!-- 右侧删除按钮 -->\n                        <template #right>\n                            <view class=\"cart-swipe-right\">\n                                <button\n                                    class=\"button delete-button\"\n                                    @tap=\"onDeleteCart(item.skuId)\"\n                                >\n                                    删除\n                                </button>\n                            </view>\n                        </template>\n                    </uni-swipe-action-item>\n                </uni-swipe-action>\n            </view>\n            <!-- 购物车空状态 -->\n            <view class=\"cart-blank\" v-else>\n                <image src=\"/static/images/blank_cart.png\" class=\"image\" />\n                <text class=\"text\">购物车还是空的，快来挑选好货吧</text>\n                <navigator open-type=\"switchTab\" url=\"/pages/index/index\" hover-class=\"none\">\n                    <button class=\"button\">去首页看看</button>\n                </navigator>\n            </view>\n            <!-- 吸底工具栏 -->\n            <view class=\"toolbar\">\n                <text @tap=\"onChangeSelectedAll\" class=\"all\" :class=\"{ checked: isSelectedAll }\"\n                    >全选\n                </text>\n                <text class=\"text\">合计:</text>\n                <text class=\"amount\">{{ selectedCartListMoney }}</text>\n                <view class=\"button-grounp\">\n                    <view\n                        class=\"button payment-button\"\n                        :class=\"{ disabled: selectedCartListCount == 0 }\"\n                        @tap=\"gotoPayment\"\n                    >\n                        去结算({{ selectedCartListCount }})\n                    </view>\n                </view>\n            </view>\n        </template>\n        <!-- 未登录: 提示登录 -->\n        <view class=\"login-blank\" v-else>\n            <text class=\"text\">登录后可查看购物车中的商品</text>\n            <navigator url=\"/pages/login/login\" hover-class=\"none\">\n                <button class=\"button\">去登录</button>\n            </navigator>\n        </view>\n        <!-- 猜你喜欢 -->\n        <!--        <XtxGuess ref=\"guessRef\"></XtxGuess>-->\n        <!--        <Hot type=\"1\" />-->\n        <!-- 底部占位空盒子 -->\n        <view class=\"toolbar-height\"></view>\n    </scroll-view>\n</template>\n\n<style lang=\"scss\">\n// 根元素\n:host {\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    background-color: #f7f7f8;\n}\n\n// 滚动容器\n.scroll-view {\n    flex: 1;\n}\n\n// 购物车列表\n.cart-list {\n    padding: 0 20rpx;\n\n    // 优惠提示\n    .tips {\n        display: flex;\n        align-items: center;\n        line-height: 1;\n        margin: 30rpx 10rpx;\n        font-size: 26rpx;\n        color: #666;\n\n        .label {\n            color: #fff;\n            padding: 7rpx 15rpx 5rpx;\n            border-radius: 4rpx;\n            font-size: 24rpx;\n            background-color: #27ba9b;\n            margin-right: 10rpx;\n        }\n    }\n\n    // 购物车商品\n    .goods {\n        display: flex;\n        padding: 20rpx 20rpx 20rpx 80rpx;\n        border-radius: 10rpx;\n        background-color: #fff;\n        position: relative;\n\n        .navigator {\n            display: flex;\n        }\n\n        .checkbox {\n            position: absolute;\n            top: 0;\n            left: 0;\n\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            width: 80rpx;\n            height: 100%;\n\n            &::before {\n                content: '\\e6cd';\n                font-family: 'erabbit' !important;\n                font-size: 40rpx;\n                color: #444;\n            }\n\n            &.checked::before {\n                content: '\\e6cc';\n                color: #27ba9b;\n            }\n        }\n\n        .picture {\n            width: 170rpx;\n            height: 170rpx;\n        }\n\n        .meta {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n            margin-left: 20rpx;\n        }\n\n        .name {\n            height: 72rpx;\n            font-size: 26rpx;\n            color: #444;\n        }\n\n        .attrsText {\n            line-height: 1.8;\n            padding: 0 15rpx;\n            font-size: 24rpx;\n            align-self: flex-start;\n            border-radius: 4rpx;\n            color: #888;\n            background-color: #f7f7f8;\n        }\n\n        .price {\n            line-height: 1;\n            font-size: 26rpx;\n            color: #444;\n            margin-bottom: 2rpx;\n            color: #cf4444;\n\n            &::before {\n                content: '￥';\n                font-size: 80%;\n            }\n        }\n\n        // 商品数量\n        .count {\n            position: absolute;\n            bottom: 20rpx;\n            right: 5rpx;\n\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            width: 220rpx;\n            height: 48rpx;\n\n            .text {\n                height: 100%;\n                padding: 0 20rpx;\n                font-size: 32rpx;\n                color: #444;\n            }\n\n            .input {\n                height: 100%;\n                text-align: center;\n                border-radius: 4rpx;\n                font-size: 24rpx;\n                color: #444;\n                background-color: #f6f6f6;\n            }\n        }\n    }\n\n    .cart-swipe {\n        display: block;\n        margin: 20rpx 0;\n    }\n\n    .cart-swipe-right {\n        display: flex;\n        height: 100%;\n\n        .button {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            width: 50px;\n            padding: 6px;\n            line-height: 1.5;\n            color: #fff;\n            font-size: 26rpx;\n            border-radius: 0;\n        }\n\n        .delete-button {\n            background-color: #cf4444;\n        }\n    }\n}\n\n// 空状态\n.cart-blank,\n.login-blank {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    height: 60vh;\n\n    .image {\n        width: 400rpx;\n        height: 281rpx;\n    }\n\n    .text {\n        color: #444;\n        font-size: 26rpx;\n        margin: 20rpx 0;\n    }\n\n    .button {\n        width: 240rpx !important;\n        height: 60rpx;\n        line-height: 60rpx;\n        margin-top: 20rpx;\n        font-size: 26rpx;\n        border-radius: 60rpx;\n        color: #fff;\n        background-color: #27ba9b;\n    }\n}\n\n// 吸底工具栏\n.toolbar {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: var(--window-bottom);\n    z-index: 1;\n\n    height: 100rpx;\n    padding: 0 20rpx;\n    display: flex;\n    align-items: center;\n    border-top: 1rpx solid #ededed;\n    border-bottom: 1rpx solid #ededed;\n    background-color: #fff;\n    box-sizing: content-box;\n\n    .all {\n        margin-left: 25rpx;\n        font-size: 14px;\n        color: #444;\n        display: flex;\n        align-items: center;\n    }\n\n    .all::before {\n        font-family: 'erabbit' !important;\n        content: '\\e6cd';\n        font-size: 40rpx;\n        margin-right: 8rpx;\n    }\n\n    .checked::before {\n        content: '\\e6cc';\n        color: #27ba9b;\n    }\n\n    .text {\n        margin-right: 8rpx;\n        margin-left: 32rpx;\n        color: #444;\n        font-size: 14px;\n    }\n\n    .amount {\n        font-size: 20px;\n        color: #cf4444;\n\n        .decimal {\n            font-size: 12px;\n        }\n\n        &::before {\n            content: '￥';\n            font-size: 12px;\n        }\n    }\n\n    .button-grounp {\n        margin-left: auto;\n        display: flex;\n        justify-content: space-between;\n        text-align: center;\n        line-height: 72rpx;\n        font-size: 13px;\n        color: #fff;\n\n        .button {\n            width: 240rpx;\n            margin: 0 10rpx;\n            border-radius: 72rpx;\n        }\n\n        .payment-button {\n            background-color: #27ba9b;\n\n            &.disabled {\n                opacity: 0.6;\n            }\n        }\n    }\n}\n\n// 底部占位空盒子\n.toolbar-height {\n    height: 100rpx;\n}\n</style>\n","import Component from 'D:/OneDrive/桌面/uniapp小程序小兔/erabbit-uni-app-vue3-ts-master/src/pages/cart/component/CartMain.vue'\nwx.createComponent(Component)"],"names":["useMemberStore","ref","getMemberCartAPI","putMemberCartBySkuIdAPI","onShow","uni","deleteMemberCartAPI","computed","putMemberCartSelectedAPI"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAcA,UAAM,cAAcA,sBAAAA;AAEd,UAAA,WAAWC,kBAAgB,CAAA,CAAE;AACnC,UAAM,oBAAoB,YAAY;AAC5B,YAAA,MAAM,MAAMC,cAAAA;AAClB,eAAS,QAAQ,IAAI;AAEb,cAAA,IAAI,IAAI,IAAI;AACZ,cAAA,IAAI,SAAS,KAAK;AAAA,IAAA;AAIxB,UAAA,mBAAmB,CAAC,SAAmB;AAEpC,WAAA,cAAc,CAAC,KAAK;AAEDC,oBAAAA,wBAAA,KAAK,OAAO,EAAE,UAAU,KAAK,eAAe,OAAO,IAAI,EAAA,CAAG;AAAA,IAAA;AAGtFC,kBAAAA,OAAO,MAAM;AACT,UAAI,YAAY,SAAS;AACH;MACtB;AAAA,IAAA,CACH;AAED,UAAM,cAAc,MAAM;AAClB,UAAA,sBAAsB,UAAU,GAAG;AACnC,eAAOC,cAAAA,MAAI,UAAU;AAAA,UACjB,MAAM;AAAA,UACN,OAAO;AAAA,QAAA,CACV;AAAA,MACL;AAEAA,oBAAAA,MAAI,WAAW,EAAE,KAAK,2BAA4B,CAAA;AAAA,IAAA;AAGhD,UAAA,eAAe,CAAC,UAAkB;AAEpCA,oBAAAA,MAAI,UAAU;AAAA,QACV,SAAS;AAAA,QACT,SAAS,OAAO,QAAQ;AACpB,cAAI,IAAI,SAAS;AAEb,kBAAMC,kCAAoB,EAAE,KAAK,CAAC,KAAK,EAAG,CAAA;AAExB;UACtB;AAAA,QACJ;AAAA,MAAA,CACH;AAAA,IAAA;AAIC,UAAA,gBAAgBC,cAAAA,SAAS,MAAM;AAC1B,aAAA,SAAS,MAAM,UAAU,SAAS,MAAM,MAAM,CAAC,MAAM,EAAE,WAAW;AAAA,IAAA,CAC5E;AAGD,UAAM,sBAAsB,MAAM;AAExB,YAAA,iBAAiB,CAAC,cAAc;AAE7B,eAAA,MAAM,QAAQ,CAAC,SAAS;AAC7B,aAAK,cAAc;AAAA,MAAA,CACtB;AAEwBC,oBAAAA,yBAAA,EAAE,UAAU,eAAA,CAAgB;AAAA,IAAA;AAGnD,UAAA,gBAAgB,CAAC,OAA4B;AAC/C,cAAQ,IAAI,EAAE;AACdL,oBAAA,wBAAwB,GAAG,OAAO,EAAE,OAAO,GAAG,OAAO;AAAA,IAAA;AAOrD,QAAA,mBAAmBI,cAAAA,SAAS,MAAM;AAClC,aAAO,SAAS,MAAM,OAAO,CAAC,MAAM,EAAE,WAAW;AAAA,IAAA,CACpD;AAGK,UAAA,wBAAwBA,cAAAA,SAAS,MAAM;AAClC,aAAA,iBAAiB,MAAM,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,OAAO,CAAC;AAAA,IAAA,CAC1E;AAGK,UAAA,wBAAwBA,cAAAA,SAAS,MAAM;AACzC,aAAO,iBAAiB,MAAM,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,QAAQ,KAAK,OAAO,CAAC,EAAE,QAAQ,CAAC;AAAA,IAAA,CAClG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtGD,GAAG,gBAAgB,SAAS;"}