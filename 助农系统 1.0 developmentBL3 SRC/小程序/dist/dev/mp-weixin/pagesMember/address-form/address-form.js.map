{"version":3,"file":"address-form.js","sources":["../../../../../src/pagesMember/address-form/address-form.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJcYWRkcmVzcy1mb3JtXGFkZHJlc3MtZm9ybS52dWU"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\nimport {\n    getMemberAddressByIdAPI,\n    postMemberAddressAPI,\n    putMemberAddressByIdAPI,\n} from '@/services/address'\nimport { onLoad } from '@dcloudio/uni-app'\n\n// 定义校验规则\nconst rules: UniHelper.UniFormsRules = {\n    receiver: {\n        rules: [{ required: true, errorMessage: '请输入收货人姓名' }],\n    },\n    contact: {\n        rules: [\n            { required: true, errorMessage: '请输入联系方式' },\n            { pattern: /^1[3-9]\\d{9}$/, errorMessage: '手机号格式不正确' },\n        ],\n    },\n    fullLocation: {\n        rules: [{ required: true, errorMessage: '请选择所在地区' }],\n    },\n    address: {\n        rules: [{ required: true, errorMessage: '请选择详细地址' }],\n    },\n}\nconst formRef = ref<UniHelper.UniFormsInstance>()\n// 表单数据\nconst form = ref({\n    receiver: '', // 收货人\n    contact: '', // 联系方式\n    fullLocation: '', // 省市区(前端展示)\n    provinceCode: '', // 省份编码(后端参数)\n    cityCode: '', // 城市编码(后端参数)\n    countyCode: '', // 区/县编码(后端参数)\n    address: '', // 详细地址\n    isDefault: 0, // 默认地址，1为是，0为否\n    provinceName: '',\n    cityName: '',\n    districtName: '',\n})\n\nconst onRegionChange: UniHelper.RegionPickerOnChange = (ev) => {\n    // console.log(ev)\n    form.value.fullLocation = ev.detail.value.join(' ')\n    const [provinceCode, cityCode, countyCode] = ev.detail.code!\n    const [provinceName, cityName, districtName] = ev.detail.value!\n    Object.assign(form.value, { provinceCode, cityCode, countyCode })\n    Object.assign(form.value, { provinceName, cityName, districtName })\n}\n\nconst onSwitchChange: UniHelper.SwitchOnChange = (ev) => {\n    form.value.isDefault = ev.detail.value == true ? 1 : 0\n}\n\n// 获取页面参数\nconst query = defineProps<{\n    id?: string\n}>()\nlet msg = ref<string>('')\n\nconst onSubmit = async () => {\n    try {\n        // 表单校验\n        await formRef.value?.validate?.()\n        // 判断当前页面是否有地址 id\n        if (query.id) {\n            // 修改地址请求\n\n            await putMemberAddressByIdAPI(query.id, form.value)\n        } else {\n            // 新建地址请求\n\n            await postMemberAddressAPI(form.value)\n        }\n        // 成功提示\n        uni.showToast({ icon: 'success', title: query.id ? '修改成功' : '添加成功' })\n        // 返回上一页\n        setTimeout(() => {\n            uni.navigateBack()\n        }, 400)\n    } catch (error) {\n        uni.showToast({ icon: 'error', title: '请填写完整信息' })\n    }\n}\n// 获取收货地址详情数据\nconst getMemberAddressByIdData = async () => {\n    // 有 id 才调用接口\n    if (query.id) {\n        // 发送请求\n        const res = await getMemberAddressByIdAPI(query.id)\n        // 把数据合并到表单中\n        Object.assign(form.value, res.data)\n        console.log(res.data)\n        console.log(form.value)\n    }\n}\n\n// 页面加载\nonLoad(() => {\n    getMemberAddressByIdData()\n})\nonMounted(() => {\n    if (query.id) {\n        uni.setNavigationBarTitle({ title: '修改地址' })\n    } else {\n        uni.setNavigationBarTitle({ title: '新建地址' })\n    }\n})\n</script>\n\n<template>\n    <view class=\"content\">\n        <uni-forms :rules=\"rules\" :model=\"form\" ref=\"formRef\">\n            <!-- 表单内容 -->\n            <uni-forms-item name=\"receiver\" class=\"form-item\">\n                <text class=\"label\">收货人</text>\n                <input class=\"input\" placeholder=\"请填写收货人姓名\" v-model=\"form.receiver\" />\n            </uni-forms-item>\n            <uni-forms-item name=\"contact\" class=\"form-item\">\n                <text class=\"label\">手机号码</text>\n                <input class=\"input\" placeholder=\"请填写收货人手机号码\" v-model=\"form.contact\" />\n            </uni-forms-item>\n            <uni-forms-item name=\"fullLocation\" class=\"form-item\">\n                <text class=\"label\">所在地区</text>\n                <picker\n                    class=\"picker\"\n                    mode=\"region\"\n                    @change=\"onRegionChange\"\n                    :value=\"form.fullLocation.split(' ')\"\n                >\n                    <view v-if=\"form.fullLocation\">{{ form.fullLocation }}</view>\n                    <view v-else class=\"placeholder\">请选择省/市/区(县)</view>\n                </picker>\n            </uni-forms-item>\n            <vieuni-forms-itemw name=\"address\" class=\"form-item\">\n                <text class=\"label\">详细地址</text>\n                <input class=\"input\" placeholder=\"街道、楼牌号等信息\" v-model=\"form.address\" />\n            </vieuni-forms-itemw>\n            <uni-forms-item class=\"form-item\">\n                <label class=\"label\">设为默认地址</label>\n                <switch\n                    class=\"switch\"\n                    color=\"#27ba9b\"\n                    @change=\"onSwitchChange\"\n                    :checked=\"form.isDefault == 1\"\n                />\n            </uni-forms-item>\n        </uni-forms>\n    </view>\n    <!-- 提交按钮 -->\n    <button class=\"button\" @click=\"onSubmit\">保存并使用</button>\n</template>\n\n<style lang=\"scss\">\npage {\n    background-color: #f4f4f4;\n}\n\n.content {\n    margin: 20rpx 20rpx 0;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n\n    .form-item,\n    .uni-forms-item {\n        display: flex;\n        align-items: center;\n        min-height: 96rpx;\n        padding: 25rpx 10rpx 40rpx;\n        background-color: #fff;\n        font-size: 28rpx;\n        border-bottom: 1rpx solid #ddd;\n        position: relative;\n        margin-bottom: 0;\n\n        // 调整 uni-forms 样式\n        .uni-forms-item__content {\n            display: flex;\n        }\n\n        .uni-forms-item__error {\n            margin-left: 200rpx;\n        }\n\n        &:last-child {\n            border: none;\n        }\n\n        .label {\n            width: 200rpx;\n            color: #333;\n        }\n\n        .input {\n            flex: 1;\n            display: block;\n            height: 46rpx;\n        }\n\n        .switch {\n            position: absolute;\n            right: -20rpx;\n            transform: scale(0.8);\n        }\n\n        .picker {\n            flex: 1;\n        }\n\n        .placeholder {\n            color: #808080;\n        }\n    }\n}\n\n.button {\n    height: 80rpx;\n    margin: 30rpx 20rpx;\n    color: #fff;\n    border-radius: 80rpx;\n    font-size: 30rpx;\n    background-color: #27ba9b;\n}\n</style>\n","import MiniProgramPage from 'D:/OneDrive/桌面/uniapp小程序小兔/erabbit-uni-app-vue3-ts-master/src/pagesMember/address-form/address-form.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","putMemberAddressByIdAPI","postMemberAddressAPI","uni","getMemberAddressByIdAPI","onLoad","onMounted"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAUA,UAAM,QAAiC;AAAA,MACnC,UAAU;AAAA,QACN,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,YAAY;AAAA,MACxD;AAAA,MACA,SAAS;AAAA,QACL,OAAO;AAAA,UACH,EAAE,UAAU,MAAM,cAAc,UAAU;AAAA,UAC1C,EAAE,SAAS,iBAAiB,cAAc,WAAW;AAAA,QACzD;AAAA,MACJ;AAAA,MACA,cAAc;AAAA,QACV,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAW;AAAA,MACvD;AAAA,MACA,SAAS;AAAA,QACL,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAW;AAAA,MACvD;AAAA,IAAA;AAEJ,UAAM,UAAUA,cAAAA;AAEhB,UAAM,OAAOA,cAAAA,IAAI;AAAA,MACb,UAAU;AAAA;AAAA,MACV,SAAS;AAAA;AAAA,MACT,cAAc;AAAA;AAAA,MACd,cAAc;AAAA;AAAA,MACd,UAAU;AAAA;AAAA,MACV,YAAY;AAAA;AAAA,MACZ,SAAS;AAAA;AAAA,MACT,WAAW;AAAA;AAAA,MACX,cAAc;AAAA,MACd,UAAU;AAAA,MACV,cAAc;AAAA,IAAA,CACjB;AAEK,UAAA,iBAAiD,CAAC,OAAO;AAE3D,WAAK,MAAM,eAAe,GAAG,OAAO,MAAM,KAAK,GAAG;AAClD,YAAM,CAAC,cAAc,UAAU,UAAU,IAAI,GAAG,OAAO;AACvD,YAAM,CAAC,cAAc,UAAU,YAAY,IAAI,GAAG,OAAO;AACzD,aAAO,OAAO,KAAK,OAAO,EAAE,cAAc,UAAU,YAAY;AAChE,aAAO,OAAO,KAAK,OAAO,EAAE,cAAc,UAAU,cAAc;AAAA,IAAA;AAGhE,UAAA,iBAA2C,CAAC,OAAO;AACrD,WAAK,MAAM,YAAY,GAAG,OAAO,SAAS,OAAO,IAAI;AAAA,IAAA;AAO/CA,kBAAAA,IAAY,EAAE;AAExB,UAAM,WAAW,YAAY;;AACrB,UAAA;AAEM,gBAAA,mBAAQ,UAAR,mBAAe,aAAf;AAEN,YAAI,MAAM,IAAI;AAGV,gBAAMC,iBAAwB,wBAAA,MAAM,IAAI,KAAK,KAAK;AAAA,QAAA,OAC/C;AAGG,gBAAAC,iBAAA,qBAAqB,KAAK,KAAK;AAAA,QACzC;AAEIC,sBAAAA,MAAA,UAAU,EAAE,MAAM,WAAW,OAAO,MAAM,KAAK,SAAS,OAAA,CAAQ;AAEpE,mBAAW,MAAM;AACbA,wBAAA,MAAI,aAAa;AAAA,WAClB,GAAG;AAAA,eACD,OAAO;AACZA,sBAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,WAAW;AAAA,MACrD;AAAA,IAAA;AAGJ,UAAM,2BAA2B,YAAY;AAEzC,UAAI,MAAM,IAAI;AAEV,cAAM,MAAM,MAAMC,iBAAAA,wBAAwB,MAAM,EAAE;AAElD,eAAO,OAAO,KAAK,OAAO,IAAI,IAAI;AAC1B,gBAAA,IAAI,IAAI,IAAI;AACZ,gBAAA,IAAI,KAAK,KAAK;AAAA,MAC1B;AAAA,IAAA;AAIJC,kBAAAA,OAAO,MAAM;AACgB;IAAA,CAC5B;AACDC,kBAAAA,UAAU,MAAM;AACZ,UAAI,MAAM,IAAI;AACVH,sBAAAA,MAAI,sBAAsB,EAAE,OAAO,OAAQ,CAAA;AAAA,MAAA,OACxC;AACHA,sBAAAA,MAAI,sBAAsB,EAAE,OAAO,OAAQ,CAAA;AAAA,MAC/C;AAAA,IAAA,CACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5GD,GAAG,WAAW,eAAe;"}