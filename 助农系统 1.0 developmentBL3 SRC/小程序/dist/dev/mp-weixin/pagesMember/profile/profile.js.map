{"version":3,"file":"profile.js","sources":["../../../../../src/pagesMember/profile/profile.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJccHJvZmlsZVxwcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\nimport { getMemberProfileAPI, putMemberProfileAPI } from '@/services/profile'\nimport type { Gender, ProfileDetail } from '@/types/member'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { ref } from 'vue'\nimport { useMemberStore } from '@/stores'\n\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\n// 获取个人信息\nlet profile = ref<ProfileDetail>({} as ProfileDetail)\nconst getMemberProfileData = async () => {\n    const res = await getMemberProfileAPI()\n    profile.value = res.data\n}\n\nconst memberStore = useMemberStore()\n\nconst onAvatarChange = () => {\n    uni.chooseMedia({\n        //   文件个数\n        count: 1,\n        mediaType: ['image'],\n        success: (res) => {\n            //   本地路径\n            const { tempFilePath } = res.tempFiles[0]\n            uni.uploadFile({\n                url: '/member/profile/avatar',\n                name: 'file',\n                filePath: tempFilePath,\n                success: (res) => {\n                    if (res.statusCode == 200) {\n                        const avatar = JSON.parse(res.data).result.avatar\n                        profile.value!.avatar = avatar\n                        memberStore.profile.avatar = avatar\n                        uni.showToast({\n                            title: '更新成功',\n                            icon: 'success',\n                        })\n                    } else {\n                        uni.showToast({\n                            icon: 'error',\n                            title: '上传图片失败',\n                        })\n                    }\n                },\n            })\n        },\n    })\n}\n\n//修改性别\nconst onGenderChange: UniHelper.RadioGroupOnChange = (ev) => {\n    // console.log(ev)\n    profile.value.gender = ev.detail.value as Gender\n}\n// 修改生日\nconst onBirthdayChange: UniHelper.DatePickerOnChange = (ev) => {\n    // console.log(ev)\n    profile.value.birthday = ev.detail.value\n}\n\n// 修改地区\nlet fullLocationCode: [string, string, string] = ['', '', '']\nconst onFullLocationChange: UniHelper.RegionPickerOnChange = (ev) => {\n    // console.log(ev)\n    // 修改前端字段\n    profile.value.fullLocation = ev.detail.value.join(' ')\n    fullLocationCode = ev.detail.code!\n}\n\n// 点击保存提交表单\nconst onsubmit = async () => {\n    const { nickname, gender, birthday, profession } = profile.value\n    const res = await putMemberProfileAPI({\n        nickname: nickname,\n        gender: gender,\n        birthday: birthday,\n        profession: profession,\n        provinceCode: fullLocationCode[0],\n        cityCode: fullLocationCode[1],\n        countyCode: fullLocationCode[2],\n    })\n    if (res.code == 1) {\n        uni.showToast({\n            title: '保存成功',\n            icon: 'none',\n        })\n        setTimeout(() => {\n            uni.navigateBack()\n        }, 500)\n    }\n}\n\nonLoad(() => {\n    getMemberProfileData()\n})\n</script>\n\n<template>\n    <view class=\"viewport\">\n        <!-- 导航栏 -->\n        <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n            <navigator\n                open-type=\"navigateBack\"\n                class=\"back icon-left\"\n                hover-class=\"none\"\n            ></navigator>\n            <view class=\"title\">个人信息</view>\n        </view>\n        <!-- 头像 -->\n        <view class=\"avatar\" @tap=\"onAvatarChange\">\n            <view class=\"avatar-content\">\n                <image class=\"image\" :src=\"profile!.avatar\" mode=\"aspectFill\" />\n                <text class=\"text\">点击修改头像</text>\n            </view>\n        </view>\n        <!-- 表单 -->\n        <view class=\"form\">\n            <!-- 表单内容 -->\n            <view class=\"form-content\">\n                <view class=\"form-item\">\n                    <text class=\"label\">账号</text>\n                    <text class=\"account\">{{ profile!.account }}</text>\n                </view>\n                <view class=\"form-item\">\n                    <text class=\"label\">昵称</text>\n                    <input\n                        class=\"input\"\n                        type=\"text\"\n                        placeholder=\"请填写昵称\"\n                        v-model=\"profile!.nickname\"\n                    />\n                </view>\n                <view class=\"form-item\">\n                    <text class=\"label\">性别</text>\n                    <radio-group @change=\"onGenderChange\">\n                        <label class=\"radio\">\n                            <radio value=\"男\" color=\"#27ba9b\" :checked=\"profile?.gender == '1'\" />\n                            男\n                        </label>\n                        <label class=\"radio\">\n                            <radio value=\"女\" color=\"#27ba9b\" :checked=\"profile?.gender == '0'\" />\n                            女\n                        </label>\n                    </radio-group>\n                </view>\n                <view class=\"form-item\">\n                    <text class=\"label\">出生日期</text>\n                    <picker\n                        class=\"picker\"\n                        mode=\"date\"\n                        :value=\"profile?.birthday\"\n                        start=\"1900-01-01\"\n                        :end=\"new Date()\"\n                        @change=\"onBirthdayChange\"\n                    >\n                        <view v-if=\"profile?.birthday\">{{ profile?.birthday }}</view>\n                        <view class=\"placeholder\" v-else>请选择日期</view>\n                    </picker>\n                </view>\n                <view class=\"form-item\">\n                    <text class=\"label\">城市</text>\n                    <picker\n                        class=\"picker\"\n                        :value=\"profile?.fullLocation?.split(' ')\"\n                        mode=\"region\"\n                        @change=\"onFullLocationChange\"\n                    >\n                        <view v-if=\"profile?.fullLocation\">{{ profile?.fullLocation }}</view>\n                        <view class=\"placeholder\" v-else>请选择城市</view>\n                    </picker>\n                </view>\n                <view class=\"form-item\">\n                    <text class=\"label\">职业</text>\n                    <input\n                        class=\"input\"\n                        type=\"text\"\n                        placeholder=\"请填写职业\"\n                        v-model=\"profile!.profession\"\n                    />\n                </view>\n            </view>\n            <!-- 提交按钮 -->\n            <button class=\"form-button\" @tap=\"onsubmit\">保 存</button>\n        </view>\n    </view>\n</template>\n<style lang=\"scss\">\npage {\n    background-color: #f4f4f4;\n}\n\n.viewport {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    //background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\n    background-size: auto 420rpx;\n    background-repeat: no-repeat;\n}\n\n// 导航栏\n.navbar {\n    position: relative;\n\n    .title {\n        height: 40px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-size: 16px;\n        font-weight: 500;\n        //color: #fff;\n    }\n\n    .back {\n        position: absolute;\n        height: 40px;\n        width: 40px;\n        left: 0;\n        font-size: 20px;\n        color: #fff;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n}\n\n// 头像\n.avatar {\n    text-align: center;\n    width: 100%;\n    height: 260rpx;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n\n    .image {\n        width: 160rpx;\n        height: 160rpx;\n        border-radius: 50%;\n        background-color: #eee;\n    }\n\n    .text {\n        display: block;\n        padding-top: 20rpx;\n        line-height: 1;\n        font-size: 26rpx;\n        //color: #fff;\n    }\n}\n\n// 表单\n.form {\n    background-color: #f4f4f4;\n\n    &-content {\n        margin: 20rpx 20rpx 0;\n        padding: 0 20rpx;\n        border-radius: 10rpx;\n        //background-color: #fff;\n    }\n\n    &-item {\n        display: flex;\n        height: 96rpx;\n        line-height: 46rpx;\n        padding: 25rpx 10rpx;\n        background-color: #fff;\n        font-size: 28rpx;\n        //border-bottom: 1rpx solid #ddd;\n\n        &:last-child {\n            border: none;\n        }\n\n        .label {\n            width: 180rpx;\n            color: #333;\n        }\n\n        .account {\n            color: #666;\n        }\n\n        .input {\n            flex: 1;\n            display: block;\n            height: 46rpx;\n        }\n\n        .radio {\n            margin-right: 20rpx;\n        }\n\n        .picker {\n            flex: 1;\n        }\n\n        .placeholder {\n            color: #808080;\n        }\n    }\n\n    &-button {\n        height: 80rpx;\n        text-align: center;\n        line-height: 80rpx;\n        margin: 30rpx 20rpx;\n        color: #fff;\n        border-radius: 80rpx;\n        font-size: 30rpx;\n        background-color: #27ba9b;\n    }\n}\n</style>\n","import MiniProgramPage from 'D:/OneDrive/桌面/uniapp小程序小兔/erabbit-uni-app-vue3-ts-master/src/pagesMember/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getMemberProfileAPI","useMemberStore","res","putMemberProfileAPI","onLoad"],"mappings":";;;;;;;;;AAQA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAG7C,QAAA,UAAUC,kBAAmB,CAAA,CAAmB;AACpD,UAAM,uBAAuB,YAAY;AAC/B,YAAA,MAAM,MAAMC,iBAAAA;AAClB,cAAQ,QAAQ,IAAI;AAAA,IAAA;AAGxB,UAAM,cAAcC,sBAAAA;AAEpB,UAAM,iBAAiB,MAAM;AACzBH,oBAAAA,MAAI,YAAY;AAAA;AAAA,QAEZ,OAAO;AAAA,QACP,WAAW,CAAC,OAAO;AAAA,QACnB,SAAS,CAAC,QAAQ;AAEd,gBAAM,EAAE,aAAiB,IAAA,IAAI,UAAU,CAAC;AACxCA,wBAAAA,MAAI,WAAW;AAAA,YACX,KAAK;AAAA,YACL,MAAM;AAAA,YACN,UAAU;AAAA,YACV,SAAS,CAACI,SAAQ;AACVA,kBAAAA,KAAI,cAAc,KAAK;AACvB,sBAAM,SAAS,KAAK,MAAMA,KAAI,IAAI,EAAE,OAAO;AAC3C,wBAAQ,MAAO,SAAS;AACxB,4BAAY,QAAQ,SAAS;AAC7BJ,8BAAAA,MAAI,UAAU;AAAA,kBACV,OAAO;AAAA,kBACP,MAAM;AAAA,gBAAA,CACT;AAAA,cAAA,OACE;AACHA,8BAAAA,MAAI,UAAU;AAAA,kBACV,MAAM;AAAA,kBACN,OAAO;AAAA,gBAAA,CACV;AAAA,cACL;AAAA,YACJ;AAAA,UAAA,CACH;AAAA,QACL;AAAA,MAAA,CACH;AAAA,IAAA;AAIC,UAAA,iBAA+C,CAAC,OAAO;AAEjD,cAAA,MAAM,SAAS,GAAG,OAAO;AAAA,IAAA;AAG/B,UAAA,mBAAiD,CAAC,OAAO;AAEnD,cAAA,MAAM,WAAW,GAAG,OAAO;AAAA,IAAA;AAIvC,QAAI,mBAA6C,CAAC,IAAI,IAAI,EAAE;AACtD,UAAA,uBAAuD,CAAC,OAAO;AAGjE,cAAQ,MAAM,eAAe,GAAG,OAAO,MAAM,KAAK,GAAG;AACrD,yBAAmB,GAAG,OAAO;AAAA,IAAA;AAIjC,UAAM,WAAW,YAAY;AACzB,YAAM,EAAE,UAAU,QAAQ,UAAU,eAAe,QAAQ;AACrD,YAAA,MAAM,MAAMK,qCAAoB;AAAA,QAClC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,cAAc,iBAAiB,CAAC;AAAA,QAChC,UAAU,iBAAiB,CAAC;AAAA,QAC5B,YAAY,iBAAiB,CAAC;AAAA,MAAA,CACjC;AACG,UAAA,IAAI,QAAQ,GAAG;AACfL,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACT;AACD,mBAAW,MAAM;AACbA,wBAAA,MAAI,aAAa;AAAA,WAClB,GAAG;AAAA,MACV;AAAA,IAAA;AAGJM,kBAAAA,OAAO,MAAM;AACY;IAAA,CACxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChGD,GAAG,WAAW,eAAe;"}